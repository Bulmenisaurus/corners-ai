"use strict";(()=>{var M=(i,e)=>()=>(i&&(e=i(i=0)),e);var I=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports);var T=(i,e,t)=>new Promise((o,n)=>{var r=a=>{try{s(t.next(a))}catch(c){n(c)}},l=a=>{try{s(t.throw(a))}catch(c){n(c)}},s=a=>a.done?o(a.value):Promise.resolve(a.value).then(r,l);s((t=t.apply(i,e)).next())});var u,E,v=M(()=>{"use strict";u=class{constructor(e){this.pieces=e}getPiece(e,t){return this.pieces[e+t*8]}setPiece(e,t,o){this.pieces[e+t*8]=o}getTileColor(e,t){return["white","black"][(e+t)%2]}coordinates(){let e=[];for(let t=0;t<8;t++)for(let o=0;o<8;o++)e.push([o,t]);return e}doMove(e){let t=this.getPiece(e.fromX,e.fromY);this.setPiece(e.fromX,e.fromY,"none"),this.setPiece(e.toX,e.toY,t)}undoMove(e){let t=this.getPiece(e.toX,e.toY);this.setPiece(e.fromX,e.fromY,t),this.setPiece(e.toX,e.toY,"none")}},E=(i,e)=>{e.append(i.tilesElement,i.piecesElement)}});var S,b,p,g,y=M(()=>{"use strict";S=i=>{let e=n=>`${n.fromX},${n.fromY},${n.toX},${n.toY}`,t={};for(let n of i){let r=e(n);r in t?t[r].push(n):t[r]=[n]}let o=[];for(let n in t){let r=t[n].sort((l,s)=>l.fullMovePath.length-s.fullMovePath.length);o.push(r[0])}return o},b=(i,e,t)=>{let o=g(i,e,t,{fromX:i,fromY:e,toX:-1,toY:-1,fullMovePath:[[i,e]]},!1);return S(o)},p=i=>({fromX:i.fromX,fromY:i.fromY,fullMovePath:[...i.fullMovePath],toX:i.toX,toY:i.toY}),g=(i,e,t,o,n)=>{let r=[],l=[[0,1],[1,1],[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1]];for(let[s,a]of l){if(n)continue;let c=i+s,d=e+a;if(c>7||c<0||d>7||d<0||t.getPiece(c,d)!=="none")continue;let m=p(o);m.fullMovePath.push([c,d]),m.toX=c,m.toY=d,r.push(m)}for(let[s,a]of l){let c=i+s*2,d=e+a*2;if(c>7||c<0||d>7||d<0)continue;let m=i+s,Y=e+a,k=t.getPiece(m,Y)!="none",C=t.getPiece(c,d)=="none",B=o.fullMovePath.some(([h,A])=>h==c&&A==d);if(!k||!C||B)continue;let P=p(o);P.fullMovePath.push([c,d]);let X=g(c,d,t,P,!0);for(let h of X)r.push(h)}if(n){let s=p(o);s.toX=i,s.toY=e,r.push(s)}return r}});var f,w=M(()=>{"use strict";v();y();f=class{constructor(e,t,o){this.board=new u(Array(8*8).fill("none")),this.currentTurn="white",this.aiWorker=new Worker("./dist/worker.js"),this.boardElement=e,this.tilesElement=t,this.piecesElement=o,this.difficulty="easy",this.selectedTileCoordinates=void 0,e.addEventListener("click",n=>{this.onClick(n)}),this.aiWorker.onmessage=n=>{this.receiveAiMove(n.data)},this._initializeTileElements()}_initializeTileElements(){let e=this.board.coordinates().map(([t,o])=>{let n=document.createElement("div");return n.classList.add("tile"),n.classList.add(this.getTileColor(t,o)),n.dataset.selected="false",n});this.tilesElement.append(...e)}loadFen(e){let t=e.split("/"),o=0,n=0;for(let r of t){for(let l of r)l==="P"?(this.setPiece(o,n,"white"),o++):l==="p"?(this.setPiece(o,n,"black"),o++):o+=parseInt(l);o=0,n+=1}}getTileElement(e,t){return Array.from(this.tilesElement.children)[e+t*8]}getPieceElement(e,t){return Array.from(this.piecesElement.children).find(r=>r.dataset.x===e.toString()&&r.dataset.y===t.toString())}setPiece(e,t,o){if(this.board.getPiece(e,t)==="none"){this.board.setPiece(e,t,o);let n=document.createElement("div");n.classList.add("piece"),n.dataset.pieceType=o,n.dataset.x=e.toString(),n.dataset.y=t.toString(),n.style.top=`calc(100%/8 * ${t} + (100%/8 - 10px) * 0.10)`,n.style.left=`calc(100%/8 * ${e} + (100%/8 - 10px) * 0.10)`,this.piecesElement.appendChild(n)}{let n=this.getPieceElement(e,t);n.dataset.pieceType=o}}uiAnimateMove(e){let{fromX:t,fromY:o,toX:n,toY:r}=e,l=this.getPieceElement(t,o);l.dataset.x=n.toString(),l.dataset.y=r.toString();let s=Math.min(1e3/(e.fullMovePath.length-1),500);l.style.transitionDuration=`${s}ms`;for(let a=1;a<e.fullMovePath.length;a++){let[c,d]=e.fullMovePath[a];window.setTimeout(()=>{l.style.top=`calc(100%/8 * ${d} + (100%/8 - 10px) * 0.10)`,l.style.left=`calc(100%/8 * ${c} + (100%/8 - 10px) * 0.10)`},s*(a-1))}l.style.zIndex="1",window.setTimeout(()=>{l.style.zIndex=""},s*e.fullMovePath.length)}select(e,t){let o=this.getTileElement(e,t);o.dataset.selected="true"}unselect(e,t){let o=this.getTileElement(e,t);o.dataset.selected="false"}getTileColor(e,t){return this.board.getTileColor(e,t)}addSuggestions(e,t){let o=b(e,t,this.board);for(let n of o)this.getTileElement(n.toX,n.toY).classList.add("valid")}clearSuggestions(){Array.from(document.querySelectorAll(".valid")).map(e=>e.classList.remove("valid"))}onClick(e){let t=e.offsetX,o=e.offsetY,n=t/this.boardElement.getBoundingClientRect().width,r=o/this.boardElement.getBoundingClientRect().height,l=Math.floor(n*8),s=Math.floor(r*8);this.onTileClick(l,s)}onTileClick(e,t){let o=this.selectedTileCoordinates;if(o!==void 0)this.unselect(o[0],o[1]),this.selectedTileCoordinates=void 0,this.tryMove(o[0],o[1],e,t);else{if(this.board.getPiece(e,t)==="none")return;this.selectedTileCoordinates=[e,t],this.select(e,t)}}removeMarks(){Array.from(document.querySelectorAll(".mark")).map(e=>e.classList.remove("mark"))}markMove(e){e.fullMovePath.forEach(([t,o])=>{this.getTileElement(t,o).classList.add("mark")})}initiateAiMove(){this.aiWorker.postMessage([this.board.pieces,this.currentTurn,this.difficulty])}receiveAiMove(e){this.currentTurn=this.currentTurn==="black"?"white":"black",e===void 0?console.warn("AI has no response, probably end of game?"):(this.doMove(e),this.markMove(e))}doMove(e){this.board.setPiece(e.toX,e.toY,this.board.getPiece(e.fromX,e.fromY)),this.board.setPiece(e.fromX,e.fromY,"none"),this.uiAnimateMove(e),this.removeMarks()}undoMove(e){let t=this.board.getPiece(e.toX,e.toY);this.setPiece(e.fromX,e.fromY,t),this.setPiece(e.toX,e.toY,"none")}tryMove(e,t,o,n){if(this.board.getPiece(e,t)!==this.currentTurn||e===o&&t==n)return;let l=b(e,t,this.board).find(s=>s.toX===o&&s.toY===n);if(l===void 0){new Audio("./audio/wood-sound-error.mp3").play();return}this.doMove(l),this.currentTurn=this.currentTurn==="black"?"white":"black",window.setTimeout(()=>{this.initiateAiMove()},1e3)}}});var F=I(L=>{v();w();var H=i=>T(L,null,function*(){let e=document.createElement("div");e.id="board-container",i.appendChild(e);let t=document.createElement("div");t.id="tiles";let o=document.createElement("div");o.id="pieces";let n=new f(e,t,o);n.loadFen("4pppp/5ppp/6pp/7p/P/PP/PPP/PPPP"),E(n,e);let r=document.getElementById("easy"),l=document.getElementById("medium"),s=document.getElementById("hard");r.onclick=()=>{r.dataset.selected="true",l.dataset.selected=s.dataset.selected="false",n.difficulty="easy",localStorage.setItem("difficulty","easy")},l.onclick=()=>{l.dataset.selected="true",r.dataset.selected=s.dataset.selected="false",n.difficulty="medium",localStorage.setItem("difficulty","medium")},s.onclick=()=>{s.dataset.selected="true",r.dataset.selected=l.dataset.selected="false",n.difficulty="hard",localStorage.setItem("difficulty","hard")};let a={easy:r,medium:l,hard:s},c=localStorage.getItem("difficulty");(c==="easy"||c==="medium"||c==="hard")&&(n.difficulty=c,a[c].dataset.selected="true")});window.addEventListener("load",()=>{let i=document.getElementsByTagName("main")[0];H(i)})});F();})();
