"use strict";(()=>{var M=(i,e)=>()=>(i&&(e=i(i=0)),e);var I=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports);var E=(i,e,t)=>new Promise((n,o)=>{var r=a=>{try{s(t.next(a))}catch(c){o(c)}},l=a=>{try{s(t.throw(a))}catch(c){o(c)}},s=a=>a.done?n(a.value):Promise.resolve(a.value).then(r,l);s((t=t.apply(i,e)).next())});var m,T,v=M(()=>{"use strict";m=class{constructor(e){this.pieces=e}getPiece(e,t){return this.pieces[e+t*8]}setPiece(e,t,n){this.pieces[e+t*8]=n}getTileColor(e,t){return["white","black"][(e+t)%2]}coordinates(){let e=[];for(let t=0;t<8;t++)for(let n=0;n<8;n++)e.push([n,t]);return e}doMove(e){let t=this.getPiece(e.fromX,e.fromY);this.setPiece(e.fromX,e.fromY,"none"),this.setPiece(e.toX,e.toY,t)}undoMove(e){let t=this.getPiece(e.toX,e.toY);this.setPiece(e.fromX,e.fromY,t),this.setPiece(e.toX,e.toY,"none")}},T=(i,e)=>{e.append(i.tilesElement,i.piecesElement)}});var S,b,p,g,y=M(()=>{"use strict";S=i=>{let e=o=>`${o.fromX},${o.fromY},${o.toX},${o.toY}`,t={};for(let o of i){let r=e(o);r in t?t[r].push(o):t[r]=[o]}let n=[];for(let o in t){let r=t[o].sort((l,s)=>l.fullMovePath.length-s.fullMovePath.length);n.push(r[0])}return n},b=(i,e,t)=>{let n=g(i,e,t,{fromX:i,fromY:e,toX:-1,toY:-1,fullMovePath:[[i,e]]},!1);return S(n)},p=i=>({fromX:i.fromX,fromY:i.fromY,fullMovePath:[...i.fullMovePath],toX:i.toX,toY:i.toY}),g=(i,e,t,n,o)=>{let r=[],l=[[0,1],[1,1],[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1]];for(let[s,a]of l){if(o)continue;let c=i+s,d=e+a;if(c>7||c<0||d>7||d<0||t.getPiece(c,d)!=="none")continue;let u=p(n);u.fullMovePath.push([c,d]),u.toX=c,u.toY=d,r.push(u)}for(let[s,a]of l){let c=i+s*2,d=e+a*2;if(c>7||c<0||d>7||d<0)continue;let u=i+s,k=e+a,L=t.getPiece(u,k)!="none",C=t.getPiece(c,d)=="none",X=n.fullMovePath.some(([h,A])=>h==c&&A==d);if(!L||!C||X)continue;let P=p(n);P.fullMovePath.push([c,d]);let B=g(c,d,t,P,!0);for(let h of B)r.push(h)}if(o){let s=p(n);s.toX=i,s.toY=e,r.push(s)}return r}});var f,w=M(()=>{"use strict";v();y();f=class{constructor(e,t,n){this.board=new m(Array(8*8).fill("none")),this.currentTurn="white",this.aiWorker=new Worker("./dist/worker.js"),this.boardElement=e,this.tilesElement=t,this.piecesElement=n,this.difficulty="easy",this.selectedTileCoordinates=void 0,e.addEventListener("click",o=>{this.onClick(o)}),this.aiWorker.onmessage=o=>{this.receiveAiMove(o.data)},this._initializeTileElements()}_initializeTileElements(){let e=this.board.coordinates().map(([t,n])=>{let o=document.createElement("div");return o.classList.add("tile"),o.classList.add(this.getTileColor(t,n)),o.dataset.selected="false",o});this.tilesElement.append(...e)}loadFen(e){let t=e.split("/"),n=0,o=0;for(let r of t){for(let l of r)l==="P"?(this.setPiece(n,o,"white"),n++):l==="p"?(this.setPiece(n,o,"black"),n++):n+=parseInt(l);n=0,o+=1}}getTileElement(e,t){return Array.from(this.tilesElement.children)[e+t*8]}getPieceElement(e,t){return Array.from(this.piecesElement.children).find(r=>r.dataset.x===e.toString()&&r.dataset.y===t.toString())}setPiece(e,t,n){if(this.board.getPiece(e,t)==="none"){this.board.setPiece(e,t,n);let o=document.createElement("div");o.classList.add("piece"),o.dataset.pieceType=n,o.dataset.x=e.toString(),o.dataset.y=t.toString(),o.style.top=`calc(100%/8 * ${t} + (100%/8) * 0.10)`,o.style.left=`calc(100%/8 * ${e} + (100%/8) * 0.10)`,this.piecesElement.appendChild(o)}{let o=this.getPieceElement(e,t);o.dataset.pieceType=n}}uiAnimateMove(e){let{fromX:t,fromY:n,toX:o,toY:r}=e,l=this.getPieceElement(t,n);l.dataset.x=o.toString(),l.dataset.y=r.toString();for(let s=1;s<e.fullMovePath.length;s++){let[a,c]=e.fullMovePath[s];window.setTimeout(()=>{l.style.top=`calc(100%/8 * ${c} + (100%/8) * 0.10)`,l.style.left=`calc(100%/8 * ${a} + (100%/8) * 0.10)`},500*(s-1))}l.style.zIndex="1",window.setTimeout(()=>{l.style.zIndex=""},500*e.fullMovePath.length)}select(e,t){let n=this.getTileElement(e,t);n.dataset.selected="true"}unselect(e,t){let n=this.getTileElement(e,t);n.dataset.selected="false"}getTileColor(e,t){return this.board.getTileColor(e,t)}addSuggestions(e,t){let n=b(e,t,this.board);for(let o of n)this.getTileElement(o.toX,o.toY).classList.add("valid")}clearSuggestions(){Array.from(document.querySelectorAll(".valid")).map(e=>e.classList.remove("valid"))}onClick(e){let t=e.offsetX,n=e.offsetY,o=t/this.boardElement.getBoundingClientRect().width,r=n/this.boardElement.getBoundingClientRect().height,l=Math.floor(o*8),s=Math.floor(r*8);this.onTileClick(l,s)}onTileClick(e,t){let n=this.selectedTileCoordinates;if(n!==void 0)this.unselect(n[0],n[1]),this.selectedTileCoordinates=void 0,this.tryMove(n[0],n[1],e,t);else{if(this.board.getPiece(e,t)==="none")return;this.selectedTileCoordinates=[e,t],this.select(e,t)}}removeMarks(){Array.from(document.querySelectorAll(".mark")).map(e=>e.classList.remove("mark"))}markMove(e){e.fullMovePath.forEach(([t,n])=>{this.getTileElement(t,n).classList.add("mark")})}initiateAiMove(){this.aiWorker.postMessage([this.board.pieces,this.currentTurn,this.difficulty])}receiveAiMove(e){this.currentTurn=this.currentTurn==="black"?"white":"black",e===void 0?console.warn("AI has no response, probably end of game?"):(this.doMove(e),this.markMove(e))}doMove(e){this.board.setPiece(e.toX,e.toY,this.board.getPiece(e.fromX,e.fromY)),this.board.setPiece(e.fromX,e.fromY,"none"),this.uiAnimateMove(e),this.removeMarks()}undoMove(e){let t=this.board.getPiece(e.toX,e.toY);this.setPiece(e.fromX,e.fromY,t),this.setPiece(e.toX,e.toY,"none")}tryMove(e,t,n,o){if(this.board.getPiece(e,t)!==this.currentTurn||e===n&&t==o)return;let l=b(e,t,this.board).find(s=>s.toX===n&&s.toY===o);if(l===void 0){new Audio("./audio/wood-sound-error.mp3").play();return}this.doMove(l),this.currentTurn=this.currentTurn==="black"?"white":"black",window.setTimeout(()=>{this.initiateAiMove()},1e3)}}});var F=I(Y=>{v();w();var H=i=>E(Y,null,function*(){let e=document.createElement("div");e.id="board-container",i.appendChild(e);let t=document.createElement("div");t.id="tiles";let n=document.createElement("div");n.id="pieces";let o=new f(e,t,n);o.loadFen("4pppp/5ppp/6pp/7p/P/PP/PPP/PPPP"),T(o,e);let r=document.getElementById("easy"),l=document.getElementById("medium"),s=document.getElementById("hard");r.onclick=()=>{r.dataset.selected="true",l.dataset.selected=s.dataset.selected="false",o.difficulty="easy",localStorage.setItem("difficulty","easy")},l.onclick=()=>{l.dataset.selected="true",r.dataset.selected=s.dataset.selected="false",o.difficulty="medium",localStorage.setItem("difficulty","medium")},s.onclick=()=>{s.dataset.selected="true",r.dataset.selected=l.dataset.selected="false",o.difficulty="hard",localStorage.setItem("difficulty","hard")},o.difficulty=localStorage.getItem("difficulty")||o.difficulty,o.difficulty==="easy"&&(r.dataset.selected="true"),o.difficulty==="medium"&&(l.dataset.selected="true"),o.difficulty==="hard"&&(s.dataset.selected="true")});window.addEventListener("load",()=>{let i=document.getElementsByTagName("main")[0];H(i)})});F();})();
