"use strict";(()=>{var P=(s,e)=>()=>(s&&(e=s(s=0)),e);var W=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports);var L=(s,e,t)=>new Promise((o,n)=>{var i=l=>{try{c(t.next(l))}catch(r){n(r)}},a=l=>{try{c(t.throw(l))}catch(r){n(r)}},c=l=>l.done?o(l.value):Promise.resolve(l.value).then(i,a);c((t=t.apply(s,e)).next())});var $,v,b,B,T=P(()=>{"use strict";M();$=s=>{let e=n=>`${n.fromX},${n.fromY},${n.toX},${n.toY}`,t={};for(let n of s){let i=e(n);i in t?t[i].push(n):t[i]=[n]}let o=[];for(let n in t){let i=t[n].sort((a,c)=>a.fullMovePath.length-c.fullMovePath.length);o.push(i[0])}return o},v=(s,e,t)=>{let o=B(s,e,t,{fromX:s,fromY:e,toX:-1,toY:-1,fullMovePath:[[s,e]]},!1);return $(o)},b=s=>({fromX:s.fromX,fromY:s.fromY,fullMovePath:[...s.fullMovePath],toX:s.toX,toY:s.toY}),B=(s,e,t,o,n)=>{let i=[],a=[[0,1],[1,1],[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1]];for(let[c,l]of a){if(n)continue;let r=s+c,u=e+l;if(r>7||r<0||u>7||u<0||t.getPiece(r,u)!=m)continue;let f=b(o);f.fullMovePath.push([r,u]),f.toX=r,f.toY=u,i.push(f)}for(let[c,l]of a){let r=s+c*2,u=e+l*2;if(r>7||r<0||u>7||u<0)continue;let f=s+c,X=e+l,Y=t.getPiece(f,X)!=m,x=t.getPiece(r,u)==m,H=o.fullMovePath.some(([E,D])=>E==r&&D==u);if(!Y||!x||H)continue;let C=b(o);C.fullMovePath.push([r,u]);let _=B(r,u,t,C,!0);for(let E of _)i.push(E)}if(n){let c=b(o);c.toX=s,c.toY=e,i.push(c)}return i}});var I,w=P(()=>{"use strict";M();T();I=(s,e)=>{let t=s===d?0:7,o=s===d?7:0;return 1e3-e.coordinates().filter(([l,r])=>e.getPiece(l,r)===s).map(([l,r])=>Math.abs(l-t)+Math.abs(r-o)).reduce((l,r)=>l+r,0)}});var d,h,m,g,A,y,p,S,M=P(()=>{"use strict";w();T();d="black",h="white",m="none",g="black",A="white",y=class{constructor(e){this.pieces=e}getPiece(e,t){return this.pieces[e+t*8]}setPiece(e,t,o){this.pieces[e+t*8]=o}getTileColor(e,t){return[A,g][(e+t)%2]}coordinates(){let e=[];for(let t=0;t<8;t++)for(let o=0;o<8;o++)e.push([o,t]);return e}doMove(e){let t=this.getPiece(e.fromX,e.fromY);this.setPiece(e.fromX,e.fromY,m),this.setPiece(e.toX,e.toY,t)}undoMove(e){let t=this.getPiece(e.toX,e.toY);this.setPiece(e.fromX,e.fromY,t),this.setPiece(e.toX,e.toY,m)}},p=class{constructor(e,t,o){this.board=new y(Array(8*8).fill(m)),this.currentTurn="white",this.aiWorker=new Worker("./dist/worker.js"),this.boardElement=e,this.tilesElement=t,this.piecesElement=o,this.selectedTileCoordinates=void 0,e.addEventListener("click",n=>{this.onClick(n)}),this.aiWorker.onmessage=n=>{this.receiveAiMove(n.data)},this._initializeTileElements()}_initializeTileElements(){let e=this.board.coordinates().map(([t,o])=>{let n=document.createElement("div");return n.classList.add("tile"),n.classList.add(this.getTileColor(t,o)===g?"black":"white"),n.dataset.selected="false",n});this.tilesElement.append(...e)}loadFen(e){let t=e.split("/"),o=0,n=0;for(let i of t){for(let a of i)a==="P"?(this.setPiece(o,n,h),o++):a==="p"?(this.setPiece(o,n,d),o++):o+=parseInt(a);o=0,n+=1}}getTileElement(e,t){return Array.from(this.tilesElement.children)[e+t*8]}getPieceElement(e,t){return Array.from(this.piecesElement.children).find(i=>i.dataset.x===e.toString()&&i.dataset.y===t.toString())}setPiece(e,t,o){if(this.board.getPiece(e,t)===m){this.board.setPiece(e,t,o);let n=document.createElement("div");n.classList.add("piece"),n.dataset.pieceType=o,n.dataset.x=e.toString(),n.dataset.y=t.toString(),n.style.top=`calc(100%/8 * ${t} + (100%/8 - 10px) * 0.10)`,n.style.left=`calc(100%/8 * ${e} + (100%/8 - 10px) * 0.10)`,this.piecesElement.appendChild(n)}{let n=this.getPieceElement(e,t);n.dataset.pieceType=o}}movePiece(e,t,o,n){let i=this.getPieceElement(e,t);i.dataset.x=o.toString(),i.dataset.y=n.toString(),i.style.zIndex="1",window.setTimeout(()=>{i.style.zIndex=""},1e3),i.style.top=`calc(100%/8 * ${n} + (100%/8 - 10px) * 0.10)`,i.style.left=`calc(100%/8 * ${o} + (100%/8 - 10px) * 0.10)`,this.board.setPiece(o,n,this.board.getPiece(e,t)),this.board.setPiece(e,t,m)}select(e,t){let o=this.getTileElement(e,t);o.dataset.selected="true"}unselect(e,t){let o=this.getTileElement(e,t);o.dataset.selected="false"}getTileColor(e,t){return[A,g][(e+t)%2]}addSuggestions(e,t){let o=v(e,t,this.board);for(let n of o)this.getTileElement(n.toX,n.toY).classList.add("valid")}clearSuggestions(){Array.from(document.querySelectorAll(".valid")).map(e=>e.classList.remove("valid"))}onClick(e){let t=e.offsetX,o=e.offsetY,n=t/this.boardElement.getBoundingClientRect().width,i=o/this.boardElement.getBoundingClientRect().height,a=Math.floor(n*8),c=Math.floor(i*8);this.onTileClick(a,c)}onTileClick(e,t){let o=this.selectedTileCoordinates;if(o!==void 0)this.unselect(o[0],o[1]),this.selectedTileCoordinates=void 0,this.tryMove(o[0],o[1],e,t);else{if(this.board.getPiece(e,t)===m)return;this.selectedTileCoordinates=[e,t],this.select(e,t)}}markMove(e){Array.from(document.querySelectorAll(".mark")).map(t=>t.classList.remove("mark")),e.fullMovePath.forEach(([t,o])=>{this.getTileElement(t,o).classList.add("mark")})}initiateAiMove(){this.aiWorker.postMessage([this.board.pieces,this.currentTurn])}receiveAiMove(e){this.currentTurn=this.currentTurn===d?h:d,e===void 0?console.warn("AI has no response, probably end of game?"):(this.doMove(e),this.markMove(e))}doMove(e){this.movePiece(e.fromX,e.fromY,e.toX,e.toY)}undoMove(e){let t=this.board.getPiece(e.toX,e.toY);this.setPiece(e.fromX,e.fromY,t),this.setPiece(e.toX,e.toY,m)}tryMove(e,t,o,n){if(this.board.getPiece(e,t)!==this.currentTurn||e===o&&t==n)return;let a=v(e,t,this.board).find(c=>c.toX===o&&c.toY===n);if(a===void 0){new Audio("./audio/wood-sound-error.mp3").play();return}this.doMove(a),console.log(`My score: ${I(h,this.board)}`),this.currentTurn=this.currentTurn===d?h:d,this.initiateAiMove()}},S=(s,e)=>{e.append(s.tilesElement,s.piecesElement)}});var O=W(k=>{M();var F=s=>L(k,null,function*(){let e=document.createElement("div");e.id="board-container",s.appendChild(e);let t=document.createElement("div");t.id="tiles";let o=document.createElement("div");o.id="pieces";let n=new p(e,t,o);n.loadFen("4pppp/5ppp/6pp/7p/P/PP/PPP/PPPP"),S(n,e)});window.addEventListener("load",()=>{let s=document.getElementsByTagName("main")[0];F(s)})});O();})();
