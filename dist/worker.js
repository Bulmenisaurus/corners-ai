"use strict";(()=>{var Y=t=>{let e=s=>`${s.fromX},${s.fromY},${s.toX},${s.toY}`,o={};for(let s of t){let c=e(s);c in o?o[c].push(s):o[c]=[s]}let n=[];for(let s in o){let c=o[s].sort((u,l)=>u.fullMovePath.length-l.fullMovePath.length);n.push(c[0])}return n},v=(t,e,o)=>{let n=y(t,e,o,{fromX:t,fromY:e,toX:-1,toY:-1,fullMovePath:[[t,e]]},!1);return Y(n)},g=(t,e)=>{let o=[];for(let n of t.coordinates()){if(!(t.getPiece(n[0],n[1])===e))continue;v(n[0],n[1],t).forEach(u=>o.push(u))}return o},P=t=>({fromX:t.fromX,fromY:t.fromY,fullMovePath:[...t.fullMovePath],toX:t.toX,toY:t.toY}),y=(t,e,o,n,s)=>{let c=[],u=[[0,1],[1,1],[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1]];for(let[l,i]of u){if(s)continue;let r=t+l,a=e+i;if(r>7||r<0||a>7||a<0||o.getPiece(r,a)!=f)continue;let d=P(n);d.fullMovePath.push([r,a]),d.toX=r,d.toY=a,c.push(d)}for(let[l,i]of u){let r=t+l*2,a=e+i*2;if(r>7||r<0||a>7||a<0)continue;let d=t+l,I=e+i,w=o.getPiece(d,I)!=f,S=o.getPiece(r,a)==f,B=n.fullMovePath.some(([E,X])=>E==r&&X==a);if(!w||!S||B)continue;let T=P(n);T.fullMovePath.push([r,a]);let k=y(r,a,o,T,!0);for(let E of k)c.push(E)}if(s){let l=P(n);l.toX=t,l.toY=e,c.push(l)}return c};var m="black",h="white",f="none",x="black",H="white",p=class{constructor(e){this.pieces=e}getPiece(e,o){return this.pieces[e+o*8]}setPiece(e,o,n){this.pieces[e+o*8]=n}getTileColor(e,o){return[H,x][(e+o)%2]}coordinates(){let e=[];for(let o=0;o<8;o++)for(let n=0;n<8;n++)e.push([n,o]);return e}doMove(e){let o=this.getPiece(e.fromX,e.fromY);this.setPiece(e.fromX,e.fromY,f),this.setPiece(e.toX,e.toY,o)}undoMove(e){let o=this.getPiece(e.toX,e.toY);this.setPiece(e.fromX,e.fromY,o),this.setPiece(e.toX,e.toY,f)}};var L=(t,e)=>{if(M(e,t)===980)return;let n=t.coordinates().filter(([i,r])=>t.getPiece(i,r)===e).map(([i,r])=>v(i,r,t)).flat();n=_(n,e);let s=n[0],c=-1/0,u=Date.now();for(let i of n){t.doMove(i);let r=A(2,t,e===h?m:h,-1/0,1/0);t.undoMove(i);let a=-r;a>c&&(c=a,s=i)}let l=Date.now();return console.log(`Took ${l-u}ms to evaluate positions`),console.log(`Evaluated ${b} position`),b=0,s},_=(t,e)=>t.sort((o,n)=>C(o,e)-C(n,e)).reverse(),b=0,C=(t,e)=>{b++;let o=e===m?0:7,n=e===m?7:0,s=Math.abs(t.fromX-o)+Math.abs(t.fromY-n),c=Math.abs(t.toX-o)+Math.abs(t.toY-n);return s-c},A=(t,e,o,n,s)=>{let c=M(o,e)===980;if(t===0||c)return D(e,o);let u=g(e,o);for(let l of u){e.doMove(l);let i=-A(t-1,e,o===m?h:m,-s,-n);if(e.undoMove(l),i>=s)return s;n=Math.max(n,i)}return n},D=(t,e)=>{let o=M(h,t),n=M(m,t);return(o-n)*(e===h?1:-1)},M=(t,e)=>{let o=t===m?0:7,n=t===m?7:0;return 1e3-e.coordinates().filter(([i,r])=>e.getPiece(i,r)===t).map(([i,r])=>Math.abs(i-o)+Math.abs(r-n)).reduce((i,r)=>i+r,0)};onmessage=t=>{let e=new p(t.data[0]),o=L(e,t.data[1]);postMessage(o)};})();
