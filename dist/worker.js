"use strict";(()=>{var Y=t=>{let e=s=>`${s.fromX},${s.fromY},${s.toX},${s.toY}`,o={};for(let s of t){let r=e(s);r in o?o[r].push(s):o[r]=[s]}let n=[];for(let s in o){let r=o[s].sort((u,l)=>u.fullMovePath.length-l.fullMovePath.length);n.push(r[0])}return n},E=(t,e,o)=>{let n=y(t,e,o,{fromX:t,fromY:e,toX:-1,toY:-1,fullMovePath:[[t,e]]},!1);return Y(n)},g=(t,e)=>{let o=[];for(let n of t.coordinates()){if(!(t.getPiece(n[0],n[1])===e))continue;E(n[0],n[1],t).forEach(u=>o.push(u))}return o},P=t=>({fromX:t.fromX,fromY:t.fromY,fullMovePath:[...t.fullMovePath],toX:t.toX,toY:t.toY}),y=(t,e,o,n,s)=>{let r=[],u=[[0,1],[1,1],[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1]];for(let[l,a]of u){if(s)continue;let i=t+l,c=e+a;if(i>7||i<0||c>7||c<0||o.getPiece(i,c)!=d)continue;let m=P(n);m.fullMovePath.push([i,c]),m.toX=i,m.toY=c,r.push(m)}for(let[l,a]of u){let i=t+l*2,c=e+a*2;if(i>7||i<0||c>7||c<0)continue;let m=t+l,I=e+a,_=o.getPiece(m,I)!=d,S=o.getPiece(i,c)==d,w=n.fullMovePath.some(([p,X])=>p==i&&X==c);if(!_||!S||w)continue;let b=P(n);b.fullMovePath.push([i,c]);let B=y(i,c,o,b,!0);for(let p of B)r.push(p)}if(s){let l=P(n);l.toX=t,l.toY=e,r.push(l)}return r};var f="black",h="white",d="none",k="black",x="white",v=class{constructor(e){this.pieces=e}getPiece(e,o){return this.pieces[e+o*8]}setPiece(e,o,n){this.pieces[e+o*8]=n}getTileColor(e,o){return[x,k][(e+o)%2]}coordinates(){let e=[];for(let o=0;o<8;o++)for(let n=0;n<8;n++)e.push([n,o]);return e}doMove(e){let o=this.getPiece(e.fromX,e.fromY);this.setPiece(e.fromX,e.fromY,d),this.setPiece(e.toX,e.toY,o)}undoMove(e){let o=this.getPiece(e.toX,e.toY);this.setPiece(e.fromX,e.fromY,o),this.setPiece(e.toX,e.toY,d)}};var A=(t,e,o)=>{if(M(e,t)===980)return;let s=t.coordinates().filter(([i,c])=>t.getPiece(i,c)===e).map(([i,c])=>E(i,c,t)).flat();s=D(s,e);let r=s[0],u=-1/0,l=Date.now();for(let i of s){t.doMove(i);let c=L(o?1:2,t,e===h?f:h,-1/0,1/0);t.undoMove(i);let m=-c;m>u&&(u=m,r=i)}let a=Date.now();return console.log(`Took ${a-l}ms to evaluate positions`),console.log(`Evaluated ${T} position`),T=0,r},D=(t,e)=>t.sort((o,n)=>C(o,e)-C(n,e)).reverse(),T=0,C=(t,e)=>{T++;let o=e===f?0:7,n=e===f?7:0,s=Math.abs(t.fromX-o)+Math.abs(t.fromY-n),r=Math.abs(t.toX-o)+Math.abs(t.toY-n);return s-r},L=(t,e,o,n,s)=>{let r=M(o,e)===980;if(t===0||r)return H(e,o);let u=g(e,o);for(let l of u){e.doMove(l);let a=-L(t-1,e,o===f?h:f,-s,-n);if(e.undoMove(l),a>=s)return s;n=Math.max(n,a)}return n},H=(t,e)=>{let o=M(h,t),n=M(f,t);return(o-n)*(e===h?1:-1)},M=(t,e)=>{let o=t===f?0:7,n=t===f?7:0;return 1e3-e.coordinates().filter(([a,i])=>e.getPiece(a,i)===t).map(([a,i])=>Math.abs(a-o)+Math.abs(i-n)).reduce((a,i)=>a+i,0)};onmessage=t=>{let e=new v(t.data[0]),o=A(e,t.data[1],t.data[2]);postMessage(o)};})();
