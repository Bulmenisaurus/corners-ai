"use strict";(()=>{var f="black",d="white",h="none",y="black",C="white";var _=t=>{let e=s=>`${s.fromX},${s.fromY},${s.toX},${s.toY}`,o={};for(let s of t){let i=e(s);i in o?o[i].push(s):o[i]=[s]}let n=[];for(let s in o){let i=o[s].sort((u,l)=>u.fullMovePath.length-l.fullMovePath.length);n.push(i[0])}return n},v=(t,e,o)=>{let n=L(t,e,o,{fromX:t,fromY:e,toX:-1,toY:-1,fullMovePath:[[t,e]]},!1);return _(n)},I=(t,e)=>{let o=[];for(let n of t.coordinates()){if(!(t.getPiece(n[0],n[1])===e))continue;v(n[0],n[1],t).forEach(u=>o.push(u))}return o},T=t=>({fromX:t.fromX,fromY:t.fromY,fullMovePath:[...t.fullMovePath],toX:t.toX,toY:t.toY}),L=(t,e,o,n,s)=>{let i=[],u=[[0,1],[1,1],[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1]];for(let[l,a]of u){if(s)continue;let r=t+l,c=e+a;if(r>7||r<0||c>7||c<0||o.getPiece(r,c)!=h)continue;let m=T(n);m.fullMovePath.push([r,c]),m.toX=r,m.toY=c,i.push(m)}for(let[l,a]of u){let r=t+l*2,c=e+a*2;if(r>7||r<0||c>7||c<0)continue;let m=t+l,M=e+a,X=o.getPiece(m,M)!=h,B=o.getPiece(r,c)==h,S=n.fullMovePath.some(([P,x])=>P==r&&x==c);if(!X||!B||S)continue;let g=T(n);g.fullMovePath.push([r,c]);let k=L(r,c,o,g,!0);for(let P of k)i.push(P)}if(s){let l=T(n);l.toX=t,l.toY=e,i.push(l)}return i};var Y=(t,e,o)=>{if(E(e,t)===980)return;let n={easy:0,medium:1,hard:2}[o],i=t.coordinates().filter(([c,m])=>t.getPiece(c,m)===e).map(([c,m])=>v(c,m,t)).flat();i=H(i,e);let u=i[0],l=-1/0,a=Date.now();for(let c of i){t.doMove(c);let m=w(n,t,e===d?f:d,-1/0,1/0);t.undoMove(c);let M=-m;M>l&&(l=M,u=c)}let r=Date.now();return console.log(`Took ${r-a}ms to evaluate positions (difficulty=${o})`),console.log(`Evaluated ${b} position`),b=0,u},H=(t,e)=>t.sort((o,n)=>A(o,e)-A(n,e)).reverse(),b=0,A=(t,e)=>{b++;let o=e===f?0:7,n=e===f?7:0,s=Math.abs(t.fromX-o)+Math.abs(t.fromY-n),i=Math.abs(t.toX-o)+Math.abs(t.toY-n);return s-i},w=(t,e,o,n,s)=>{let i=E(o,e)===980;if(t===0||i)return D(e,o);let u=I(e,o);for(let l of u){e.doMove(l);let a=-w(t-1,e,o===f?d:f,-s,-n);if(e.undoMove(l),a>=s)return s;n=Math.max(n,a)}return n},D=(t,e)=>{let o=E(d,t),n=E(f,t);return(o-n)*(e===d?1:-1)},E=(t,e)=>{let o=t===f?0:7,n=t===f?7:0;return 1e3-e.coordinates().filter(([a,r])=>e.getPiece(a,r)===t).map(([a,r])=>Math.abs(a-o)+Math.abs(r-n)).reduce((a,r)=>a+r,0)};var p=class{constructor(e){this.pieces=e}getPiece(e,o){return this.pieces[e+o*8]}setPiece(e,o,n){this.pieces[e+o*8]=n}getTileColor(e,o){return[C,y][(e+o)%2]}coordinates(){let e=[];for(let o=0;o<8;o++)for(let n=0;n<8;n++)e.push([n,o]);return e}doMove(e){let o=this.getPiece(e.fromX,e.fromY);this.setPiece(e.fromX,e.fromY,h),this.setPiece(e.toX,e.toY,o)}undoMove(e){let o=this.getPiece(e.toX,e.toY);this.setPiece(e.fromX,e.fromY,o),this.setPiece(e.toX,e.toY,h)}};onmessage=t=>{let e=new p(t.data[0]),o=Y(e,t.data[1],t.data[2]);postMessage(o)};})();
