"use strict";(()=>{var a="black",M="white",v="none",C="black",B="white";var K=o=>{let e=s=>`${s.fromX},${s.fromY},${s.toX},${s.toY}`,t={};for(let s of o){let r=e(s);r in t?t[r].push(s):t[r]=[s]}let n=[];for(let s in t){let r=t[s].sort((m,u)=>m.fullMovePath.length-u.fullMovePath.length);n.push(r[0])}return n},d=(o,e,t)=>{let n=g(o,e,t,{fromX:o,fromY:e,toX:-1,toY:-1,fullMovePath:[[o,e]]},!1);return K(n)},Y=(o,e)=>{let t=[];for(let n of o.coordinates()){if(!(o.getPiece(n[0],n[1])===e))continue;d(n[0],n[1],o).forEach(m=>t.push(m))}return t},I=o=>({fromX:o.fromX,fromY:o.fromY,fullMovePath:[...o.fullMovePath],toX:o.toX,toY:o.toY}),g=(o,e,t,n,s)=>{let r=[],m=[[0,1],[1,1],[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1]];for(let[u,f]of m){if(s)continue;let c=o+u,i=e+f;if(c>7||c<0||i>7||i<0||t.getPiece(c,i)!=v)continue;let l=I(n);l.fullMovePath.push([c,i]),l.toX=c,l.toY=i,r.push(l)}for(let[u,f]of m){let c=o+u*2,i=e+f*2;if(c>7||c<0||i>7||i<0)continue;let l=o+u,P=e+f,L=t.getPiece(l,P)!=v,x=t.getPiece(c,i)==v,A=n.fullMovePath.some(([h,w])=>h==c&&w==i);if(!L||!x||A)continue;let T=I(n);T.fullMovePath.push([c,i]);let S=g(c,i,t,T,!0);for(let h of S)r.push(h)}if(s){let u=I(n);u.toX=o,u.toY=e,r.push(u)}return r};var _=(o,e,t)=>{if(p(e,o)===980)return;let n={easy:0,medium:1,hard:2}[t],r=o.coordinates().filter(([i,l])=>o.getPiece(i,l)===e).map(([i,l])=>d(i,l,o)).flat();r=D(r,e);let m=r[0],u=-1/0,f=Date.now();for(let i of r){o.doMove(i);let l=b(n,o,e===M?a:M,-1/0,1/0);o.undoMove(i);let P=-l;P>u&&(u=P,m=i)}let c=Date.now();return console.log(`Took ${c-f}ms to evaluate positions (difficulty=${t})`),console.log(`Evaluated ${y} position`),y=0,m},D=(o,e)=>o.sort((t,n)=>X(t,e)-X(n,e)).reverse(),y=0,X=(o,e)=>{y++;let t=e===a?0:7,n=e===a?7:0,s=Math.abs(o.fromX-t)+Math.abs(o.fromY-n),r=Math.abs(o.toX-t)+Math.abs(o.toY-n);return s-r},b=(o,e,t,n,s)=>{let r=p(t,e)===980;if(o===0||r)return H(e,t);let m=Y(e,t);for(let u of m){e.doMove(u);let f=-b(o-1,e,t===a?M:a,-s,-n);if(e.undoMove(u),f>=s)return s;n=Math.max(n,f)}return n},H=(o,e)=>{let t=p(M,o),n=p(a,o);return(t-n)*(e===M?1:-1)},p=(o,e)=>{let t=o===a?0:7,n=o===a?7:0;return 1e3-e.coordinates().filter(([f,c])=>e.getPiece(f,c)===o).map(([f,c])=>Math.abs(f-t)+Math.abs(c-n)).reduce((f,c)=>f+c,0)};var E=class{constructor(e){this.pieces=e}getPiece(e,t){return this.pieces[e+t*8]}setPiece(e,t,n){this.pieces[e+t*8]=n}getTileColor(e,t){return[B,C][(e+t)%2]}coordinates(){let e=[];for(let t=0;t<8;t++)for(let n=0;n<8;n++)e.push([n,t]);return e}doMove(e){let t=this.getPiece(e.fromX,e.fromY);this.setPiece(e.fromX,e.fromY,v),this.setPiece(e.toX,e.toY,t)}undoMove(e){let t=this.getPiece(e.toX,e.toY);this.setPiece(e.fromX,e.fromY,t),this.setPiece(e.toX,e.toY,v)}};onmessage=o=>{let e=new E(o.data[0]),t=_(e,o.data[1],o.data[2]);postMessage(t)};})();
