"use strict";(()=>{var x=o=>{let e=s=>`${s.fromX},${s.fromY},${s.toX},${s.toY}`,t={};for(let s of o){let r=e(s);r in t?t[r].push(s):t[r]=[s]}let n=[];for(let s in t){let r=t[s].sort((f,u)=>f.fullMovePath.length-u.fullMovePath.length);n.push(r[0])}return n},p=(o,e,t)=>{let n=Y(o,e,t,{fromX:o,fromY:e,toX:-1,toY:-1,fullMovePath:[[o,e]]},!1);return x(n)},b=(o,e)=>{let t=[];for(let n of o.coordinates()){if(!(o.getPiece(n[0],n[1])===e))continue;p(n[0],n[1],o).forEach(f=>t.push(f))}return t},P=o=>({fromX:o.fromX,fromY:o.fromY,fullMovePath:[...o.fullMovePath],toX:o.toX,toY:o.toY}),Y=(o,e,t,n,s)=>{let r=[],f=[[0,1],[1,1],[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1]];for(let[u,m]of f){if(s)continue;let i=o+u,c=e+m;if(i>7||i<0||c>7||c<0||t.getPiece(i,c)!=="none")continue;let l=P(n);l.fullMovePath.push([i,c]),l.toX=i,l.toY=c,r.push(l)}for(let[u,m]of f){let i=o+u*2,c=e+m*2;if(i>7||i<0||c>7||c<0)continue;let l=o+u,a=e+m,B=t.getPiece(l,a)!="none",S=t.getPiece(i,c)=="none",T=n.fullMovePath.some(([h,I])=>h==i&&I==c);if(!B||!S||T)continue;let g=P(n);g.fullMovePath.push([i,c]);let k=Y(i,c,t,g,!0);for(let h of k)r.push(h)}if(s){let u=P(n);u.toX=o,u.toY=e,r.push(u)}return r};var X=(o,e,t)=>{if(v(e,o)===980)return;let n={easy:0,medium:1,hard:2}[t],r=o.coordinates().filter(([c,l])=>o.getPiece(c,l)===e).map(([c,l])=>p(c,l,o)).flat();r=D(r,e);let f=[],u=-1/0,m=Date.now();for(let c of r){o.doMove(c);let l=w(n,o,e==="white"?"black":"white",-1/0,1/0);o.undoMove(c);let a=-l;a>u?(u=a,f=[c]):a===u&&f.push(c)}let i=Date.now();return console.log(`Took ${i-m}ms to evaluate positions (difficulty=${t})`),console.log(`Evaluated ${d} position`),d=0,console.log(`Choosing one of ${f.length} options`),f[Math.floor(Math.random()*f.length)]},D=(o,e)=>o.sort((t,n)=>y(t,e)-y(n,e)).reverse(),d=0,y=(o,e)=>{d++;let t=e==="black"?0:7,n=e==="white"?7:0,s=Math.abs(o.fromX-t)+Math.abs(o.fromY-n),r=Math.abs(o.toX-t)+Math.abs(o.toY-n);return s-r},w=(o,e,t,n,s)=>{let r=v(t,e)===980;if(o===0||r)return E(e,t);let f=b(e,t);for(let u of f){e.doMove(u);let m=-w(o-1,e,t==="black"?"white":"black",-s,-n);if(e.undoMove(u),m>=s)return s;n=Math.max(n,m)}return n},E=(o,e)=>{let t=v("white",o),n=v("black",o);return(t-n)*(e==="white"?1:-1)},v=(o,e)=>{let t=o==="black"?0:7,n=o==="black"?7:0;return 1e3-e.coordinates().filter(([m,i])=>e.getPiece(m,i)===o).map(([m,i])=>Math.abs(m-t)+Math.abs(i-n)).reduce((m,i)=>m+i,0)};var M=class{constructor(e){this.pieces=e}getPiece(e,t){return this.pieces[e+t*8]}setPiece(e,t,n){this.pieces[e+t*8]=n}getTileColor(e,t){return["white","black"][(e+t)%2]}coordinates(){let e=[];for(let t=0;t<8;t++)for(let n=0;n<8;n++)e.push([n,t]);return e}doMove(e){let t=this.getPiece(e.fromX,e.fromY);this.setPiece(e.fromX,e.fromY,"none"),this.setPiece(e.toX,e.toY,t)}undoMove(e){let t=this.getPiece(e.toX,e.toY);this.setPiece(e.fromX,e.fromY,t),this.setPiece(e.toX,e.toY,"none")}};onmessage=o=>{let e=new M(o.data[0]),t=X(e,o.data[1],o.data[2]);postMessage(t)};})();
