"use strict";(()=>{var a="black",M="white",v="none",T="black",g="white";var K=o=>{let e=s=>`${s.fromX},${s.fromY},${s.toX},${s.toY}`,t={};for(let s of o){let r=e(s);r in t?t[r].push(s):t[r]=[s]}let n=[];for(let s in t){let r=t[s].sort((f,u)=>f.fullMovePath.length-u.fullMovePath.length);n.push(r[0])}return n},d=(o,e,t)=>{let n=Y(o,e,t,{fromX:o,fromY:e,toX:-1,toY:-1,fullMovePath:[[o,e]]},!1);return K(n)},B=(o,e)=>{let t=[];for(let n of o.coordinates()){if(!(o.getPiece(n[0],n[1])===e))continue;d(n[0],n[1],o).forEach(f=>t.push(f))}return t},I=o=>({fromX:o.fromX,fromY:o.fromY,fullMovePath:[...o.fullMovePath],toX:o.toX,toY:o.toY}),Y=(o,e,t,n,s)=>{let r=[],f=[[0,1],[1,1],[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1]];for(let[u,m]of f){if(s)continue;let i=o+u,c=e+m;if(i>7||i<0||c>7||c<0||t.getPiece(i,c)!=v)continue;let l=I(n);l.fullMovePath.push([i,c]),l.toX=i,l.toY=c,r.push(l)}for(let[u,m]of f){let i=o+u*2,c=e+m*2;if(i>7||i<0||c>7||c<0)continue;let l=o+u,p=e+m,L=t.getPiece(l,p)!=v,x=t.getPiece(i,c)==v,A=n.fullMovePath.some(([h,w])=>h==i&&w==c);if(!L||!x||A)continue;let C=I(n);C.fullMovePath.push([i,c]);let S=Y(i,c,t,C,!0);for(let h of S)r.push(h)}if(s){let u=I(n);u.toX=o,u.toY=e,r.push(u)}return r};var _=(o,e,t)=>{if(P(e,o)===980)return;let n={easy:0,medium:1,hard:2}[t],r=o.coordinates().filter(([c,l])=>o.getPiece(c,l)===e).map(([c,l])=>d(c,l,o)).flat();r=D(r,e);let f=[],u=-1/0,m=Date.now();for(let c of r){o.doMove(c);let l=b(n,o,e===M?a:M,-1/0,1/0);o.undoMove(c);let p=-l;p>u?(u=p,f=[c]):p===u&&f.push(c)}let i=Date.now();return console.log(`Took ${i-m}ms to evaluate positions (difficulty=${t})`),console.log(`Evaluated ${y} position`),y=0,console.log(`Choosing one of ${f.length} options`),f[Math.floor(Math.random()*f.length)]},D=(o,e)=>o.sort((t,n)=>X(t,e)-X(n,e)).reverse(),y=0,X=(o,e)=>{y++;let t=e===a?0:7,n=e===a?7:0,s=Math.abs(o.fromX-t)+Math.abs(o.fromY-n),r=Math.abs(o.toX-t)+Math.abs(o.toY-n);return s-r},b=(o,e,t,n,s)=>{let r=P(t,e)===980;if(o===0||r)return H(e,t);let f=B(e,t);for(let u of f){e.doMove(u);let m=-b(o-1,e,t===a?M:a,-s,-n);if(e.undoMove(u),m>=s)return s;n=Math.max(n,m)}return n},H=(o,e)=>{let t=P(M,o),n=P(a,o);return(t-n)*(e===M?1:-1)},P=(o,e)=>{let t=o===a?0:7,n=o===a?7:0;return 1e3-e.coordinates().filter(([m,i])=>e.getPiece(m,i)===o).map(([m,i])=>Math.abs(m-t)+Math.abs(i-n)).reduce((m,i)=>m+i,0)};var E=class{constructor(e){this.pieces=e}getPiece(e,t){return this.pieces[e+t*8]}setPiece(e,t,n){this.pieces[e+t*8]=n}getTileColor(e,t){return[g,T][(e+t)%2]}coordinates(){let e=[];for(let t=0;t<8;t++)for(let n=0;n<8;n++)e.push([n,t]);return e}doMove(e){let t=this.getPiece(e.fromX,e.fromY);this.setPiece(e.fromX,e.fromY,v),this.setPiece(e.toX,e.toY,t)}undoMove(e){let t=this.getPiece(e.toX,e.toY);this.setPiece(e.fromX,e.fromY,t),this.setPiece(e.toX,e.toY,v)}};onmessage=o=>{let e=new E(o.data[0]),t=_(e,o.data[1],o.data[2]);postMessage(t)};})();
